<script src="./js/publicjs/common.js"></script>
<style>
	.pl30 {
		padding-left: 30px
	}
	
	.pl22 {
		padding-left: 22px
	}
	
	.pl7 {
		padding-left: 7px
	}
	
	.pl10 {
		padding-left: 10px
	}
	
	.pl11 {
		padding-left: 11px
	}
	
	.pl35 {
		padding-left: 35px
	}
	
	.pl39 {
		padding-left: 39px
	}
	
	.pl43 {
		padding-left: 43px
	}
	
	.pl46 {
		padding-left: 46px
	}
	
	.pl55 {
		padding-left: 55px
	}
	
	tr {
		padding: 0px;
		margin: 0px;
	}
	
	.w100 {
		width: 100px
	}
	
	.w50 {
		width: 50px
	}
	
	.w60 {
		width: 60px
	}
	
	.w80 {
		width: 80px
	}
	
	.w120 {
		width: 120px
	}
	
	.w130 {
		width: 130px
	}
	
	.w150 {
		width: 150px
	}
	
	.gridHeader {
		width: 100% !important;
	}
	
	.gridScroller {
		width: 100% !important;
	}
	
	#rendrTable_spkc_jxc table tbody tr td input {
		-moz-user-select: none;
		-webkit-user-select: none
	}
	
	.add_tdspkc {
		border-right: 1px solid #c0c0c0;
		border-bottom: 1px solid #c0c0c0;
		text-align: center;
		padding: 0px !important;
		margin: 0px;
		height: 30px;
		word-break: break-all;
	}
	
	.tbody_spkc {
		width: 2150px;
		position: absolute;
		top: 33px;
		left: 0;
		z-index: 99;
	}
	
	.tbody_spkc td input {
		width: 97px;
		font-size: 12px;
		border: none;
		text-align: center;
		cursor: pointer;
	}
	
	.tbody_spkc tr td select option {
		visibility: hidden;
	}
	
	input.readonly {
		background: none;
		text-align: center;
	}
	
	select {
		appearance: none;
		-moz-appearance: none;
		-webkit-appearance: none;
	}
	
	.select_spkc {
		width: auto;
		font-size: 12px;
		border: none;
	}
	
	.select_spkc option {
		text-align: center;
	}
	
	.bordespkc_jxc {
		float: left;
		height: 8px;
		display: inline-block;
		margin: 7px auto auto 10px;
		border: 0.1px solid #D8D8D8;
	}
	
	.entryinid_thspkc {
		color: #000;
		font-weight: bold;
		text-align: center;
		background-color: #99ccff;
		border-right: 1px solid #c0c0c0!important;
		border-bottom: 1px solid #c0c0c0!important;
		height: 30px;
	}
	
	.entryinid_thspkc:after {
		clear: both;
	}
	
	.entryinid_thspkc span {
		display: inline-block;
		float: left;
		padding-top: 4px;
	}
	
	.sdate_label_spkcjxc {
		display: inline-block;
	}
	
	.btncx_spkc {
		cursor: pointer;
	}
	
	.entryinid_thspkc select {
		appearance: none;
		-moz-appearance: none;
		-webkit-appearance: none;
		width: 100%;
		background: url(img/select.png) no-repeat 100% 7px;
		cursor: pointer;
	}
	
	#table_spkc thead tr td select {
		width: 0;
		height: 0;
		padding: 8px !important;
		border: none;
		float: left;
	}
	
	.table_theadspkc {
		width: 2150px;
		position: absolute;
		left: 0;
		z-index: 100;
	}
	
	.table_theadspkc .entryinid_thspkc {
		/*width: 100px;*/
	}
	
	#rendrTable_spkc_jxc {
		width: 100%;
		overflow: visible !important;
	}
	
	.resetkc_btn {
		float: right;
		cursor: pointer;
		border: 2px solid #99ccff;
		border-radius: 3px;
		background-color: transparent;
		color: #555;
	}
	
	.nodata_spkc_j {
		margin: 20px 0 0 20px;
		font-size: 14px;
		color: #666666;
	}
	/*分页*/
	
	.pagination_spkc_j {
		float: right;
		margin-top: 0px;
	}
	
	.pagination_spkc_j a {
		display: inline-block;
		color: #555;
		height: 18px;
		line-height: 18px;
		padding: 0 10px;
		borde_digital_storer: 1px solid #edf3f4;
		margin: 0px 2px;
		borde_digital_storer-radius: 4px;
		vertical-align: middle;
	}
	
	.pagination_spkc_j a :hover {
		text-decoration: none;
		borde_digital_storer: 1px solid darkolivegreen;
	}
	
	.pagination_spkc_j span.current,
	.pagination_spkc_j span.disabled {
		display: inline-block;
		height: 18px;
		line-height: 18px;
		padding: 0 10px;
		margin: 0 2px;
		borde_digital_storer-radius: 4px;
		vertical-align: middle;
	}
	
	.pagination_spkc_j span.current {
		color: #fff;
		background-color: #cfebee;
		borde_digital_storer: 1px solid #b8d0d6;
	}
	
	.pagination_spkc_j span.disabled {
		color: #bfbfbf;
		background: #f2f2f2;
		borde_digital_storer: 1px solid #bfbfbf;
	}
	
	.pagination_spkc_j .input_page {
		width: 50px;
		height: 12px;
		padding: 2px;
		borde_digital_storer-radius: 3px;
		borde_digital_storer: 1px solid #555;
	}
	
	.pagination_spkc_j.go:hover {
		background-color: #cfebee;
	}
	
	.pagination_spkc_j table thead {
		background: rgb(153, 204, 255);
	}
	
	.pagination_spkc_j table {
		text-align: center;
	}
	
	.pagination_spkc_j th,
	.pagination_spkc_j td {
		border: 1px solid lightgrey;
	}
	/*分页结束*/
	
	.sum_div {
		float: right;
		margin-top: 8px;
		margin-right: 20px;
		color: red;
	}
	
	.sum_jxckcb {
		font-weight: bold;
	}
</style>
<div class="pageHeader" style="overflow: hidden;">
	<div style="float:left;margin-top:2px;">
		<label class="sdate_label_spkcjxc">日期:</label>
		<input style="width:80px" id="sdate_JXCSPKC" class="date" dateFmt="yyyy-MM-dd" maxDate="{%y}-%M-{%d}" readonly="readonly" /> — <input style="width:80px" id="SZMX" class="date" dateFmt="yyyy-MM-dd" maxDate="{%y}-%M-{%d}" readonly="readonly" />
		<input type="text" placeholder="部门名称" id="deptNameId" style="display: none;" />
		<button class="btncx_spkc"> 查询</button>
	</div>

	<button class="resetkc_btn" onclick="resetkcChoose()">重置筛选</button>
	<div style="clear:both"></div>
</div>
</div>

<div style="overflow: auto;" class="scrollBox" layoutH="65">
	<div class="pageContent" id="rendrTable_spkc_jxc">
		<table id="table_spkc" cellspacing="0" cellpadding="0" border="0">
			<thead class="table_theadspkc">
				<tr class="deptNameClass" style="display: none;">
					<td class="entryinid_thspkc" style="text-align: center;" colspan="25"></td>
				</tr>
				<tr>
					<td class="entryinid_thspkc w60"><span class="pl7">档次</span>
						<select class="getdangci" onchange="get_spkc('selectList','dangci',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w100"><span class="pl30">门框</span>
						<select class="getmenkuang" onchange="get_spkc('selectList','menkuang',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w60"><span class="pl11">框厚</span>
						<select class="getkuanghou" onchange="get_spkc('selectList','kuanghou',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w60"><span class="pl7">前板厚</span>
						<select class="getqianbanhou" onchange="get_spkc('selectList','qianbanhou',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w60"><span class="pl7">后板厚</span>
						<select class="gethoubanhou" onchange="get_spkc('selectList','houbanhou',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w80"><span class="pl10">底框材料</span>
						<select class="getdikuangcl" onchange="get_spkc('selectList','dikuangcl',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w60"><span class="pl11">门扇</span>
						<select class="getmenshan" onchange="get_spkc('selectList','menshan',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w80"><span class="pl22">规格</span>
						<select class="getguige" onchange="get_spkc('selectList','guige',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w50"><span class="pl10">开向</span>
						<select class="getkaixiang" onchange="get_spkc('selectList','kaixiang',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w80"><span class="pl22">铰链</span>
						<select class="getjiaolian" onchange="get_spkc('selectList','jiaolian',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w60"><span class="pl11">花色</span>
						<select class="gethuase" onchange="get_spkc('selectList','huase',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w80"><span class="pl10">表面方式</span>
						<select class="getbiaomianfs" onchange="get_spkc('selectList','biaomianfs',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w150"><span class="pl30">表面要求</span>
						<select class="getbiaomianyq" onchange="get_spkc('selectList','biaomianyq',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w80"><span class="pl22">窗花</span>
						<select class="getchuanghua" onchange="get_spkc('selectList','chuanghua',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w150"><span class="pl55">猫眼</span>
						<select class="getmaoyan" onchange="get_spkc('selectList','maoyan',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w80"><span class="pl22">标牌</span>
						<select class="getbiaopai" onchange="get_spkc('selectList','biaopai',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w120"><span class="pl43">主锁</span>
						<select class="getzhusuo" onchange="get_spkc('selectList','zhusuo',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w120"><span class="pl43">副锁</span>
						<select class="getfusuo" onchange="get_spkc('selectList','fusuo',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w100"><span class="pl30">锁把</span>
						<select class="getsuoba" onchange="get_spkc('selectList','suoba',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w80"><span class="pl22">标件</span>
						<select class="getbiaojian" onchange="get_spkc('selectList','biaojian',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w80"><span class="pl7">包装品牌</span>
						<select class="getbaozhuangpp" onchange="get_spkc('selectList','baozhuangpp',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w80"><span class="pl7">包装方式</span>
						<select class="getbaozhuangfs" onchange="get_spkc('selectList','baozhuangfs',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w100"><span class="pl39">其它</span></td>
					<td class="entryinid_thspkc w100"><span class="pl22">制造部门</span>
						<select class="getzhizaobm" onchange="get_spkc('selectList','zhizaobm',this)">
							<option value="">全部</option>
						</select>
					</td>
					<td class="entryinid_thspkc w60"><span class="pl22">库存</span></td>
				</tr>
			</thead>
			<tbody class="tbody_spkc">
				<tbody>
		</table>
	</div>
</div>

<div class="panelBar">
	<div class="pagination_spkc_j"></div>
</div>
<script type="text/jsrender" id="jsxRender_spkcbody">
	{{for list}}
	<tr>
		<td class="add_tdspkc w60">{{:dangci}}
			<td>
				<td class="add_tdspkc w100">{{:menkuang}}
					<td>
						<td class="add_tdspkc w60">{{:kuanghou}}
							<td>
								<td class="add_tdspkc w60">{{:qianbanhou}}
									<td>
										<td class="add_tdspkc w60">{{:houbanhou}}
											<td>
												<td class="add_tdspkc w80">{{:dikuangcl}}
													<td>
														<td class="add_tdspkc w60">{{:menshan}}
															<td>
																<td class="add_tdspkc w80">{{:guige}}
																	<td>
																		<td class="add_tdspkc w50">{{:kaixiang}}
																			<td>
																				<td class="add_tdspkc w80">{{:jiaolian}}
																					<td>
																						<td class="add_tdspkc w60">{{:huase}}
																							<td>
																								<td class="add_tdspkc w80">{{:biaomianfs}}
																									<td>
																										<td class="add_tdspkc w150">{{:biaomianyq}}
																											<td>
																												<td class="add_tdspkc w80">{{:chuanghua}}
																													<td>
																														<td class="add_tdspkc w150">{{:maoyan}}
																															<td>
																																<td class="add_tdspkc w80">{{:biaopai}}
																																	<td>
																																		<td class="add_tdspkc w120">{{:zhusuo}}
																																			<td>
																																				<td class="add_tdspkc w120">{{:fusuo}}
																																					<td>
																																						<td class="add_tdspkc w100">{{:suoba}}
																																							<td>
																																								<td class="add_tdspkc w80">{{:biaojian}}
																																									<td>
																																										<td class="add_tdspkc w80">{{:baozhuangpp}}
																																											<td>
																																												<td class="add_tdspkc w80">{{:baozhuangfs}}
																																													<td>
																																														<td class="add_tdspkc w100">{{:qita}}
																																															<td>
																																																<td class="add_tdspkc w100">{{:zhizaobm}}
																																																	<td>
																																																		<td class="add_tdspkc w60">{{:storage}}
																																																			<td>
	</tr>
	{{/for}}
</script>
<script type="text/javascript">
	$(function() {
		$("#sdate_JXCSPKC").val(getServiceTime_spkc());
		$("#SZMX").val(getServiceTime_spkc());
		get_spkc("mainList");

	});
	var labelDataArr = [];

	//初始数据查询
	function get_spkc(identity, label, _this) {
		var fdm_spkcurl = "";
		var sdate = $("#sdate_JXCSPKC").val().replace(/\-/g, "");
		var edate = $("#SZMX").val().replace(/\-/g, "");
		//按总部和片区决定按部门名称查询的输入框是否显示
		if(dept_Id == 1 || dept_Id == '1' || pId == 1 || pId == '1') {
			$("#deptNameId").show();
		} else {
			$("#deptNameId").hide();
		}

		var deptnameVal = $("#deptNameId").val().trim();

		if(isDataValid(sdate) && isDataValid(edate)) {
			if(Number(edate) < Number(sdate)) {
				alertMsg.warn("起始时间不能大于结束时间！");
				return false;
			}
		}

		if(identity == "mainList") {

			if(isDataValid(deptnameVal)) {
				fdm_spkcurl = newUrl + "saleStockSystem/index.php/admin/stock/getStockList/startDate/" + sdate + "/endDate/" + edate + "/deptName/" + deptnameVal + "/token/" + token;
			} else {
				fdm_spkcurl = newUrl + "saleStockSystem/index.php/admin/stock/getStockList/startDate/" + sdate + "/endDate/" + edate + "/token/" + token;
			}

		} else if(identity == "selectList") {
			var params = "/" + label + "/" + _this.value;
			if(labelDataArr.indexOf(params) == -1) {
				labelDataArr.push(params);
			}
			var labelData = labelDataArr.join(" ");

			if(isDataValid(deptnameVal)) {
				fdm_spkcurl = newUrl + "saleStockSystem/index.php/admin/stock/getStockList/startDate/" + sdate + "/endDate/" + edate + "/deptName/" + deptnameVal + "/token/" + token + labelData;
			} else {
				fdm_spkcurl = newUrl + "saleStockSystem/index.php/admin/stock/getStockList/startDate/" + sdate + "/endDate/" + edate + "/token/" + token + labelData;
			}

		}
		$.ajax({
			type: "get",
			url: fdm_spkcurl,
			async: true,
			cache: false,
			dataType: "json",
			success: function(data) {
				if(data.resultcode == -1) {
					alertMsg.info(data.resultmsg);
					return;
				}
				if(data.resultcode == -2) {
					alertMsg.info("你的账号在其他地方登录了或者已经超时，请重新登录！");
					window.location.href = "index.html";
					return;
				}
				XSRBSZMX_test = data;
				if(data.resultcode == 0) {

					//按总部和片区决定按表头的经营部是否显示
					if(isDataValid(data.data.deptName)) {
						$(".deptNameClass").show().find("td").text(data.data.deptName);
						$("#table_spkc thead tr td select").css("top","34px");
						$(".tbody_spkc").css("top","64px");
					} else {
						$(".deptNameClass").hide();
						$("#table_spkc thead tr td select").css("top","4px");
						$(".tbody_spkc").css("top","34px");
					}
					if(isDataValid(data.data.list)) {
						var JxcSPKCMX = $("#jsxRender_spkcbody").render(data.data);
						$(".tbody_spkc").html("").append(JxcSPKCMX);
						$(".sum_jxckcb").text(data.data.sum);
						initSelectKc(data.data.list);
						fixThead_spkc();

					}else {
					$(".tbody_spkc").text("暂无数据！");
					$(".pagination_spkc_j").hide();
				}
					//查询数据为空的情况下也有可能会有分页数 
					$(".pagination_spkc_j").show().createPage({
						pageCount: Math.ceil(parseInt(data.data.totalPage)), //总页数
						current: 1, //初始页号
						backFn: function(obj) {
							get_jspkc_page(fdm_spkcurl, obj);
						}
					});
				} else {
					$(".tbody_spkc").text("暂无数据！");
					$(".pagination_spkc_j").hide();
				}
			},
			error: function(XMLHttpRequest, textStatus, errorThrown, data) {
				alertMsg.error(errorThrown);
			}
		});
	};

	$(".btncx_spkc").click(function() {
		get_spkc("mainList");
	});

	function fixThead_spkc() {
		$('.scrollBox').scroll(function() {
			$('.table_theadspkc').css('top', $(this).scrollTop() + 'px');
		});
	}

	//获取服务器时间
	function getServiceTime_spkc() {
		var getServiceTime_url = URL + "Schedule/SERVER_TIME";
		var getServiceTime = "";
		$.ajax({
			type: "get",
			url: getServiceTime_url,
			async: false,
			dataType: "json",
			success: function(data) {
				getServiceTime = data.server_time;
				return;
			},
			error: function(XMLHttpRequest, textStatus, errorThrown, data) {
				alert(errorThrown);
			}
		});
		return getServiceTime;
	}

	//初始化下拉选项
	function initSelectKc(data) {
		var selectArr = {};
		for(var i = 0; i < data.length; i++) {
			for(var j in data[i]) {
				if(selectArr[j] == undefined || selectArr[j] == '') {
					selectArr[j] = [];
				}
				if(selectArr[j].indexOf(data[i][j]) == -1) {
					if(data[i][j] != "") {
						selectArr[j].push(data[i][j]);
					}
				}
			}
		}

		for(var m in selectArr) {
			for(var n = 0; n < selectArr[m].length; n++) {
				$('.get' + m).html('<option value="">全部</option>');
			}
			for(var n = 0; n < selectArr[m].length; n++) {
				$('.get' + m).append('<option>' + selectArr[m][n] + '</option>');
			}
		}

	}
	//重置筛选
	function resetkcChoose() {
		get_spkc("mainList");
		labelDataArr = [];
	}

	//分页
	function get_jspkc_page(url_page, page) {
		$.ajax({
			type: "get",
			url: url_page + "/page/" + page,
			dataType: "json",
			async: true,
			cache: false,
			success: function(data) {
				if(data.resultcode == -2) {
					alert("你的账号在其他地方登录了或者已经超时，请重新登录！");
					window.location.href = "index.html";
				}
				if(data.resultcode == 0) {
					

					//按总部和片区决定按表头的经营部是否显示
					if(isDataValid(data.data.deptName)) {
						$(".deptNameClass").show().find("td").text(data.data.deptName);
						$("#table_spkc thead tr td select").css("top","34px");
						$(".tbody_spkc").css("top","64px");
						
						
						
					} else {
						$(".deptNameClass").hide();
						$("#table_spkc thead tr td select").css("top","4px");
						$(".tbody_spkc").css("top","34px");
					}
					if(isDataValid(data.data.list)) {
						var JxcSPKCMX = $("#jsxRender_spkcbody").render(data.data);
						$(".tbody_spkc").html("").append(JxcSPKCMX);
						initSelectKc(data.data.list);

					}else {
					$(".tbody_spkc").text("暂无数据！");
				}
				}
			},
			error: function(XMLHttpRequest, textStatus, errorThrown) {
				alert("加载失败，刷新或者检查网络设置！");
			}
		});
	}
</script>